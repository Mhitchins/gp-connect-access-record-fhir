steps:
  - bash: |
      mkdir -p build
      npm run publish 2> /dev/null
      cp build/gp-connect-access-record-fhir.json PrismMockProvider/

      cd PrismMockProvider
      docker build -t mock-reciever .
    displayName: Build mock-reciever image
    workingDirectory: "$(Pipeline.Workspace)/s/$(SERVICE_NAME)"

  - bash: |
      echo $(System.PullRequest.PullRequestNumber)
    displayName: Update the PR Number parameter in the PR pipeline

  - task: CmdLine@2
    displayName: Create artifact from variables
    inputs:
      script: |
        echo "##vso[task.setvariable variable=pr_number;]$(System.PullRequest.PullRequestNumber)" >  $(Build.ArtifactStagingDirectory)/pipeline.env

  - task: PublishBuildArtifacts@1
    displayName: publish variables
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: 'variables'
      publishLocation: 'Container'
